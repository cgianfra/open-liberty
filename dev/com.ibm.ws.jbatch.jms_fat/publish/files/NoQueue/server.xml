<server description="com.ibm.ws.jbatch.jms.internals.fat , local message engine server">

    <include location="../fatTestPorts.xml" />

	 <!-- Enable features -->
    <featureManager>
        <feature>batchManagement-1.0</feature>
    	<feature>wasJmsServer-1.0</feature>
    	<feature>wasJmsClient-2.0</feature>
    </featureManager>

    <batchPersistence jobStoreRef="BatchDatabaseStore" />

    <databaseStore id="BatchDatabaseStore" dataSourceRef="batchDB" schema="JBATCH" tablePrefix="" />

	<library id="DerbyLib">
	    <file name="${shared.resource.dir}/derby/derby.jar"/>
	</library>

	<dataSource id="batchDB" jndiName="jdbc/batch">
		<jdbcDriver libraryRef="DerbyLib" />
		<!-- The following configures in-memory Derby.  For Derby on disk, which is needed if the database
       	is required beyond a single server start, configure the databaseName with a file location such as:
       	databaseName="${shared.config.dir}/data/derbydb" -->
		<properties.derby.embedded databaseName="memory:BATCHDB"
			loginTimeout="360s"
			createDatabase="create" user="user" password="pass" />
	</dataSource>					  
	
    <keyStore id="defaultKeyStore" location="${server.config.dir}/resources/security/key.p12" type="PKCS12" password="{xor}EzY9Oi0rJg==" />
	    <!--keyStore id="defaultKeyStore" password="Liberty"/-->
    <basicRegistry id="basic" realm="ibm/api">
        <user name="bob" password="bobpwd"/>
        <user name="jane" password="janepwd"/>
    </basicRegistry>
	
    <administrator-role><user>bob</user></administrator-role>
    
	<!-- Everyone is a batch admin for non security related tests -->
	<authorization-roles id="com.ibm.ws.batch">
		<security-role name="batchAdmin">
			<user name="bob" />
			<user name="jane" />
		</security-role>
	</authorization-roles>
	
	
	<batchJmsDispatcher />
	<batchJmsExecutor />
	
	<messagingEngine>
		<queue id="batchLibertyQueue" forceReliability="ReliablePersistent"></queue>
	</messagingEngine>
	
	<!-- note that message selector need space around the equal sign-->
    <jmsActivationSpec id="batchActivationSpec">
		<properties.wasJms maxBatchSize="1" maxConcurrency="5"
		 messageSelector="com_ibm_ws_batch_applicationName = 'SimpleBatchJob' OR com_ibm_ws_batch_applicationName = 'BonusPayout'"
		 destinationRef="batchJobSubmissionQueue" destinationType="javax.jms.Queue">
		</properties.wasJms>
	</jmsActivationSpec>
	 
	<jmsQueueConnectionFactory jndiName="jms/batch/connectionFactory" id="batchConnectionFactory" connectionManagerRef="ConMgr">
		<properties.wasJms></properties.wasJms>		
	</jmsQueueConnectionFactory>
	
	<!-- minPoolSize/maxPoolSize is min/max connection per connection manager -->
	<connectionManager id="ConMgr" minPoolSize="2" maxPoolSize="40"></connectionManager>

	<javaPermission className="java.net.SocketPermission" name="*" actions="connect,resolve"/>
</server>
