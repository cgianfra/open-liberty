--CONNECT 'jdbc:derby:{databaseName};create=true';
SET CURRENT SCHEMA = JBATCH;

CREATE TABLE JOBINSTANCE (JOBINSTANCEID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, APPNAME VARCHAR(255), SUBMITTER VARCHAR(255), BATCHSTATUS INTEGER, CURRENTSTEPID VARCHAR(255), EXITSTATUS VARCHAR(255), JOBNAME VARCHAR(255), JOBXML CLOB(2147483647), JOBXMLNAME VARCHAR(255), LATESTJOBEXECID BIGINT, RESTARTON VARCHAR(255), PRIMARY KEY (JOBINSTANCEID));

CREATE TABLE JOBEXECUTION (JOBEXECID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, BATCHSTATUS INTEGER, CREATETIME TIMESTAMP, ENDTIME TIMESTAMP, EXITSTATUS VARCHAR(255), JOBPARAMETERS BLOB(2147483647), LOGPATH VARCHAR(255), SERVERID VARCHAR(255), STARTTIME TIMESTAMP, STEPSTATUS BLOB(2147483647), UPDATETIME TIMESTAMP, JOBINSTANCE_JOBINSTANCEID BIGINT, PRIMARY KEY (JOBEXECID));

CREATE TABLE STEPEXECUTION (STEPEXECID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL, BATCHSTATUS INTEGER, COMMITCOUNT BIGINT, ENDTIME TIMESTAMP, EXITSTATUS VARCHAR(255), FILTERCOUNT BIGINT, PERSISTENTDATA BLOB(2147483647), PROCESSSKIPCOUNT BIGINT, READCOUNT BIGINT, READSKIPCOUNT BIGINT, ROLLBACKCOUNT BIGINT, STARTTIME TIMESTAMP, STEPNAME VARCHAR(255), STEPSTATUS BLOB(2147483647), WRITECOUNT BIGINT, WRITESKIPCOUNT BIGINT, JOBEXEC_JOBEXECID BIGINT, PRIMARY KEY (STEPEXECID));

CREATE TABLE CHECKPOINT (ID VARCHAR(255) NOT NULL, DATA BLOB(2147483647), PRIMARY KEY (ID));

ALTER TABLE JOBEXECUTION ADD CONSTRAINT JBXJBNSTNCJBNSTNCD FOREIGN KEY (JOBINSTANCE_JOBINSTANCEID) REFERENCES JOBINSTANCEENTITY (JOBINSTANCEID);

ALTER TABLE STEPEXECUTION ADD CONSTRAINT STPXCTNNTJBXCJBXCD FOREIGN KEY (JOBEXEC_JOBEXECID) REFERENCES JOBEXECUTIONENTITY (JOBEXECID);

--COMMIT WORK;
--DISCONNECT;